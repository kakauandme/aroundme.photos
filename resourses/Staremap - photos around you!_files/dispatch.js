function setCookie(e,t,n){if(n){var r=new Date;r.setTime(r.getTime()+n*24*60*60*1e3);var i="; expires="+r.toGMTString()}else var i="";document.cookie=escape(e)+"="+escape(t)+i+"; path=/"}function getCookie(e){var t=escape(e)+"=";var n=document.cookie.split(";");for(var r=0;r<n.length;r++){var i=n[r];while(i.charAt(0)==" ")i=i.substring(1,i.length);if(i.indexOf(t)==0)return unescape(i.substring(t.length,i.length))}return null}function delCookie(e){setCookie(e,"",-1)}function AddScript(e,t){var n=document.createElement("script");n.src=e;n.type="text/javascript";n.defer=false;if(typeof t!="undefined"&&t!=null){n.onreadystatechange=function(){if(this.readyState=="complete"||this.readyState=="loaded"){this.onreadystatechange=this.onload=null;t()}};n.onload=function(){this.onreadystatechange=this.onload=null;t()}}var r=document.getElementsByTagName("head").item(0);r.appendChild(n)}function setDefaults(e){$.each(e,function(e){$("#"+e).val(this.valueOf()).data("default",this.valueOf())})}function getDefaults(e){return $("#"+e).data("default")}function reloadDefaults(){setDefaults({lat:$("#lat").val(),lng:$("#lng").val(),distance:$("#distance").val(),time:$("#time option[selected]").length>0?$("#time option[selected]").val():$("#time").val()})}function loadInfobox(){/*AddScript("http://google-maps-utility-library-v3.googlecode.com/svn/trunk/infobox/src/infobox.js",initialize)*/AddScript('/skin/default_skin/frontend/js/infobox.js', initialize)}function centerMapPosition(){var e=map.getCenter(),t=window.circle.getCenter();if(t!=undefined){e.B=t.B;e.U=t.U;google.maps.event.trigger(map,"resize");map.setCenter(e)}}function initialize(){function r(){$(".pac-container .pac-item:first .pac-item-query").html($(".pac-container .pac-item:first .pac-item-query .pac-matched").html()+" ");var e=$(".pac-container .pac-item:first").text();var t=new google.maps.Geocoder;t.geocode({address:e},function(t,n){if(n==google.maps.GeocoderStatus.OK){var r=t[0].geometry.location.lat(),i=t[0].geometry.location.lng(),s=t[0].address_components[0].long_name;setDefaults({lat:r,lng:i});$("#search_submit").trigger("click");$("input#search_inp").val(e)}})}initJQuery();var e=new google.maps.LatLng(getDefaults("lat"),getDefaults("lng")),t={cursor:"text",zoom:13,maxZoom:16,minZoom:2,panControl:true,infoBoxClearance:true,streetViewControl:false,center:e};window.map=new google.maps.Map(document.getElementById("center-block"),t);window.map.setOptions({draggableCursor:"default"});var n=document.getElementById("search_inp");window.autocomplete=new google.maps.places.Autocomplete(n);window.autocomplete.bindTo("bounds",map);google.maps.event.addDomListener(window,"resize",function(){centerMapPosition()});google.maps.event.addListener(window.autocomplete,"place_changed",function(){var e=window.autocomplete.getPlace();if(!e.geometry){return}setDefaults({lat:e.geometry.location.lat(),lng:e.geometry.location.lng()});$("#search_submit").trigger("click")});$("input#search_inp").keydown(function(e){if(e.which==13){r()}});var i=new google.maps.MarkerImage(window.icons[2],null,null,null,new google.maps.Size(25,43));window.marker=new google.maps.Marker({map:window.map,draggable:false,icon:i});window.circle=new google.maps.Circle({map:window.map,editable:false,fillColor:"#438ec3",fillOpacity:.1,strokeWeight:1,strokeColor:"#438ec3",visible:true,clickable:false});window.markers={};window.infoWindows=[];photosesion();google.maps.event.addListener(window.map,"click",function(e){var t=new google.maps.LatLng(e.latLng.lat(),e.latLng.lng());window.marker.setOptions({zIndex:1e3,animation:google.maps.Animation.DROP,position:t});setDefaults({lat:e.latLng.lat(),lng:e.latLng.lng()});window.map.setCenter(t);$("#search_submit").trigger("click")});google.maps.event.addListener(window.map,"search",function(e){(new SearchPhoto).init(e)});if(navigator.geolocation){var s=getCookie("navigation");if(s!=null){s=JSON.parse(s);initMap(s.lat,s.lng)}else{navigator.geolocation.getCurrentPosition(function(e){initMap(e.coords.latitude,e.coords.longitude)},function(){},{enableHighAccuracy:true,maximumAge:36e5,timeout:27e3})}}$("#mylocation").fadeIn()}function codeLatLng(){var e=map.getCenter();var t=new google.maps.LatLng(e.lat(),e.lng());geocoder.geocode({latLng:t},function(e,t){if(t==google.maps.GeocoderStatus.OK){if(e[3]!=undefined){$("#search_inp").val(e[3].formatted_address)}}})}function initMap(e,t){setCookie("navigation",JSON.stringify({lat:e,lng:t}),1);setDefaults({lat:e,lng:t});var n=new google.maps.LatLng(getDefaults("lat"),getDefaults("lng"));window.map.setCenter(n);geocoder=new google.maps.Geocoder;codeLatLng();$("#search_submit").trigger("click")}function processData(e,t,n,r,i){i==undefined?false:!!i;n==undefined?false:!!n;r==undefined?false:!!r;var s=$.trim($("#templateResult").html()),o=$.trim($("#templateInfo").html()),u=$.trim($("#templateComment").html()),a=$.trim($("#templateTag").html()),f=$.trim($("#templateUser").html()),l=[],c=0;$.each(e.data,function(i,h){if(e.api=="im"){var p=false;if($('#right_content .atomic-block[data-index="'+h.id+'"]').length){p=$('#right_content .atomic-block[data-index="'+h.id+'"]')}if(h.user!=undefined&&h.user.username){h.profile_link="http://instagram.com/"+h.user.username}else{h.profile_link=null}if(h.comments!=undefined&&h.comments.count>0){var d=h.comments.data,v="";for(var m in d){var g=u;d[m].username="http://instagram.com/"+d[m].from.username;g=renderTemplateItem.apply(d[m],[g,"text","text"]);g=renderTemplateItem.apply(d[m],[g,"profilelink","username"]);g=renderTemplateItem.apply(d[m],[g,"fullname","from.full_name","%%"]);g=renderTemplateItem.apply(d[m],[g,"avatar","from.profile_picture"]);v+=g}h.commentHtml=v}h.tagsHtml=null;if(h.tags!=undefined&&h.tags.length){h.tagsHtml="";for(var m in h.tags){var y=a;h.tagsHtml+=renderTemplateItem.apply(h.tags[m],[y,"tag",null,"%",h.tags[m]])}}h.usersHtml=null;if(h.users_in_photo!=undefined&&h.users_in_photo.length){h.usersHtml="";var b=h.users_in_photo.length>3?3:h.users_in_photo.length;for(var m=0;m<b;m++){var w=f;h.users_in_photo[m].user.username="http://instagram.com/"+h.users_in_photo[m].user.username;w=renderTemplateItem.apply(h.users_in_photo[m],[w,"username","user.username"]);w=renderTemplateItem.apply(h.users_in_photo[m],[w,"fullname","user.full_name","%%"]);h.usersHtml+=w}var E=$(h.usersHtml);h.usersHtml=$("<div/>").append(E.filter(function(e){return e!=E.length-1})).html();if(h.users_in_photo.length>3){h.usersHtml+=" and other "+(h.users_in_photo.length-3)+" ..."}}var S=Math.abs(parseInt((new Date).getTime()/1e3)-h.created_time);h.timestepm=S;if(window.options.lang=="ru"){h.timeago=processTimeAgoRu(S);h.sharelink="http://staremap.com/ru/im_"+h.id}else{h.timeago=processTimeAgo(S);h.sharelink="http://staremap.com/im_"+h.id}var x=s;x=renderTemplateItem.apply(h,[x,"index","id"]);x=renderTemplateItem.apply(h,[x,"imagelink","link"]);x=renderTemplateItem.apply(h,[x,"bigimg","images.standard_resolution.url"]);x=renderTemplateItem.apply(h,[x,"imageurl","images.low_resolution.url","%%"]);x=renderTemplateItem.apply(h,[x,"profilepicture","user.profile_picture"]);x=renderTemplateItem.apply(h,[x,"username","user.username"]);x=renderTemplateItem.apply(h,[x,"profile_link","profile_link"]);x=renderTemplateItem.apply(h,[x,"socialname",null,"%","instagram"]);x=renderTemplateItem.apply(h,[x,"fullname","user.full_name","%%"]);x=renderTemplateItem.apply(window,[x,"class_tag",null,"%",window.options.tag?"":"is-none"]);x=renderTemplateItem.apply(window,[x,"class_people",null,"%",window.options.people?"":"is-none"]);x=renderTemplateItem.apply(window,[x,"class_comment",null,"%",window.options.comment?"":"is-none"]);x=renderTemplateItem.apply(h,[x,"text","tagsHtml"]);x=renderTemplateItem.apply(h,[x,"users","usersHtml"]);x=renderTemplateItem.apply(h,[x,"comments","commentHtml"]);x=renderTemplateItem.apply(window,[x,"apistatusLike",h.current_likes?"apisStatus."+e.api:null,"%%"]);x=renderTemplateItem.apply(window,[x,"apistatusShare",null,"%%"]);x=renderTemplateItem.apply(h,[x,"socdetect",null,"%",e.api]);x=renderTemplateItem.apply(h,[x,"apithis",null,"%",e.api]);x=renderTemplateItem.apply(h,[x,"timeago","timeago","%"]);x=renderTemplateItem.apply(h,[x,"sharelink","sharelink","%"]);x=renderTemplateItem.apply(h,[x,"timestepm","timestepm"]);x=renderTemplateItem.apply(window,[x,"timestart",null,"%",window.timeStart]);x=renderTemplateItem.apply(window,[x,"activelike",null,"%",e.activeuser.im]);x=renderTemplateItem.apply(window,[x,"item_numder",null,"%",n||r?window.item_numder:null]);x=renderTemplateItem.apply(window,[x,"pagenumber",null,"%",n||r?window.showpages:null]);if(p){return;return p.replaceWith(p)}window.minTime[e.api]=window.minTime[e.api]==undefined?h.created_time:window.minTime[e.api]>h.created_time?h.created_time:window.minTime[e.api];c++;t.append(x);step=window.step;var T=o;T=renderTemplateItem.apply(h,[T,"index","id"]);T=renderTemplateItem.apply(h,[T,"link","link"]);T=renderTemplateItem.apply(h,[T,"profile_link","profile_link"]);T=renderTemplateItem.apply(h,[T,"profilepicture","user.profile_picture"]);T=renderTemplateItem.apply(h,[T,"imageurl","images.thumbnail.url"]);T=renderTemplateItem.apply(h,[T,"username","user.username"]);T=renderTemplateItem.apply(h,[T,"fullname","user.full_name","%%","Instagram Profile"]);T=renderTemplateItem.apply(h,[T,"timeago","timeago","%"]);l.push([h.location.latitude,h.location.longitude,T,h.link,h.id])}else if(e.api=="vk"){h.thisid=h.owner_id+"_"+h.id;if($('#right_content .atomic-block[data-index="'+h.thisid+'"]').length){return}var N=null;try{getPropByString(h,"photo_2560");N="photo_2560"}catch(C){try{getPropByString(h,"photo_1280");N="photo_1280"}catch(C){try{getPropByString(h,"photo_807");N="photo_807"}catch(C){getPropByString(h,"photo_604");N="photo_604"}}}var S=Math.abs(parseInt((new Date).getTime()/1e3)-h.date);h.timestepm=S;var k=null;if(h.profile_link!=undefined){k=h.profile_link+"?z=photo"+h.thisid}if(window.options.lang=="ru"){h.timeago=processTimeAgoRu(S);h.sharelink="http://staremap.com/ru/"+h.sharelink}else{h.timeago=processTimeAgo(S);h.sharelink="http://staremap.com/"+h.sharelink}var x=s;x=renderTemplateItem.apply(h,[x,"index","thisid"]);x=renderTemplateItem.apply(h,[x,"imagelink",null,"%",k]);x=renderTemplateItem.apply(h,[x,"bigimg",N]);x=renderTemplateItem.apply(h,[x,"imageurl","photo_604","%%"]);x=renderTemplateItem.apply(h,[x,"profilepicture","photo_50"]);x=renderTemplateItem.apply(h,[x,"username","username"]);x=renderTemplateItem.apply(h,[x,"profile_link","profile_link"]);x=renderTemplateItem.apply(h,[x,"socialname",null,"%","vk"]);x=renderTemplateItem.apply(h,[x,"fullname","fullname","%%"]);x=renderTemplateItem.apply(window,[x,"class_tag",null,"%",window.options.tag?"":"is-none"]);x=renderTemplateItem.apply(window,[x,"class_people",null,"%",window.options.people?"":"is-none"]);x=renderTemplateItem.apply(window,[x,"class_comment",null,"%",window.options.comment?"":"is-none"]);x=renderTemplateItem.apply(h,[x,"text","tagsHtml"]);x=renderTemplateItem.apply(h,[x,"users","usersHtml"]);x=renderTemplateItem.apply(h,[x,"comments","commentHtml"]);x=renderTemplateItem.apply(window,[x,"apistatusLike",null,"%%"]);x=renderTemplateItem.apply(window,[x,"apistatusShare","apisStatus."+e.api,"%%"]);x=renderTemplateItem.apply(h,[x,"socdetect",null,"%",e.api]);x=renderTemplateItem.apply(h,[x,"apithis",null,"%",e.api]);x=renderTemplateItem.apply(h,[x,"timeago","timeago","%"]);x=renderTemplateItem.apply(h,[x,"timeago","timeago","%"]);x=renderTemplateItem.apply(h,[x,"sharelink","sharelink","%"]);x=renderTemplateItem.apply(h,[x,"timestepm","timestepm"]);x=renderTemplateItem.apply(window,[x,"timestart",null,"%",window.timeStart]);x=renderTemplateItem.apply(window,[x,"activelike",null,"%",null]);x=renderTemplateItem.apply(window,[x,"item_numder",null,"%",n||r?window.item_numder:null]);x=renderTemplateItem.apply(window,[x,"pagenumber",null,"%",n||r?window.showpages:null]);if(p){return;return p.replaceWith(p)}window.minTime[e.api]=window.minTime[e.api]==undefined?h.date:window.minTime[e.api]>h.date?h.date:window.minTime[e.api];c++;t.append(x);var T=o;T=renderTemplateItem.apply(h,[T,"index","thisid"]);T=renderTemplateItem.apply(h,[T,"link",k]);T=renderTemplateItem.apply(h,[T,"profile_link","profile_link"]);T=renderTemplateItem.apply(h,[T,"profilepicture","photo_50"]);T=renderTemplateItem.apply(h,[T,"imageurl","photo_130"]);T=renderTemplateItem.apply(h,[T,"username","username"]);T=renderTemplateItem.apply(h,[T,"fullname","fullname","%%",h.profile_link?"VKontakte Profile":undefined]);T=renderTemplateItem.apply(h,[T,"timeago","timeago","%"]);l.push([h.lat,h.long,T,h.photo_604,h.thisid])}});var h=t.find(".atomic-block:not(.visible)");h.find(".head .user-info a:not(.tooltipstered)").each(function(){var e=$(this).data("tooltip-content");if(e){$(this).tooltipster({position:"top-left",offsetY:-5,content:e,animation:"grow",multiple:true,theme:"tooltipster-black"})}});$(document).trigger("loadImages");var p=$("#show-new-photo"),d=$("#right_content");if(n||r){if(e.api=="im"){window.scroller_im=c}else{window.scroller_vk=c}}if(n){p.slideUp();h.addClass("visible");d.scrollTop(0);if(window.masonry!=undefined){window.masonry.masonry("appended",h.get())}}else if(c>0&&!r){if(!p.is(":visible")){p.css({top:"-=24px"}).show().css({marginRight:(d.width()-p.outerWidth())/2}).hide().css({top:"+=24px"}).find("span").text(c).end().slideDown()}else{p.find("span").text(parseInt(p.find("span").text())+c)}}else if(window.scroller==0&&!n&&r){h.addClass("showscroll")}var v=new google.maps.MarkerImage(window.icons[0],null,null,null,new google.maps.Size(24,31));$.each(l,function(e,t){var i=new google.maps.MarkerImage(window.icons[1],null,null,null,new google.maps.Size(24,31));var s=new google.maps.Marker({position:new google.maps.LatLng(t[0],t[1]),icon:i,zIndex:e,animation:google.maps.Animation.DROP});s.setValues({zIndexDefault:e});if(!n&&c>0&&!r){s.setValues({invisible:true})}else if(window.scroller==0&&!n&&r){s.setValues({invisible:true})}s.setValues({labelClass:"labelpage"+window.pagemarker});window.marker_numder++;if(window.marker_numder>window.ajaxcount){window.marker_numder=1;window.pagemarker++}var o=new InfoBox({content:t[2],disableAutoPan:false,pixelOffset:new google.maps.Size(0,-58),zIndex:e-1,pane:"overlayImage",closeBoxMargin:"6px 10px 0 0",closeBoxURL:window.icons[3],infoBoxClearance:new google.maps.Size(1,1)});google.maps.event.addListener(s,"click",function(){var e=$("#"+t[4]);var n=e.css("top");$("#right_content").animate({scrollTop:parseInt(n)-20},300);closeAllInfoWindows();o.open(map,this);for(var r in window.markers){window.markers[r].setOptions({icon:i,zIndex:window.markers[r].zIndexDefault})}s.setOptions({icon:v,zIndex:1e4});$(".gm-style-iw:visible").css({overflow:"visible"})});google.maps.event.addListener(o,"closeclick",function(){s.setOptions({icon:i,zIndex:s.zIndexDefault})});window.infoWindows[t[4]]=o;window.markers[t[4]]=s});setAllMarkersMap(window.map)}function processTimeAgo(e){if(e<60){var t=e;return t+" second"+(t==1?"":"s")+" ago"}else if(e<3600){var t=Math.floor(e/60);return t+" minute"+(t==1?"":"s")+" ago"}else if(e<3600*24){var t=Math.floor(e/3600);return t+" hour"+(t==1?"":"s")+" ago"}else if(e<3600*24*7){var t=Math.floor(e/(3600*24));return t+" day"+(t==1?"":"s")+" ago"}else{return"more than week ago"}}function processTimeAgoRu(e){if(e<60){var t=e;return t+" секунд"+(t==1||t%10==1&&t!=11?"у":t%10<5&&t%10>0&&(t>20||t<10)?"ы":"")+" назад"}else if(e<3600){var t=Math.floor(e/60);return t+" минут"+(t==1?"у":t%10<5&&t%10>0&&(t>20||t<10)?"ы":"")+" назад"}else if(e<3600*24){var t=Math.floor(e/3600);return t+" час"+(t==1?"":t%10<5&&t%10>0&&(t>20||t<10)?"а":"ов")+" назад"}else if(e<3600*24*7){var t=Math.floor(e/(3600*24));return t+(t==1?" день":t<5?" дня":" дней")+" назад"}else{return"более недели назад"}}function intervalUpdate(e){return false;window.intervalTiming[e]=(new Date).getTime();window.intervalUpdating[e]=setTimeout(function(){var t={preAjax:$.noop,generateData:function(){return{lat:getDefaults("lat"),lng:getDefaults("lng"),distance:getDefaults("distance"),time:Math.round(((new Date).getTime()-window.intervalTiming[e])/1e3)}},errorFunction:$.noop,successFunction:function(e){if(!Object.keys&&e!=null&&e.data!=undefined){var t=$("<div/>",{css:{position:"absolute",left:"-10000px"}});processData(e,t);$("#results-container").prepend(t.children());t.remove()}else if(e!=null&&e.data!=undefined&&Object.keys(e.data).length>0){var t=$("<div/>",{css:{position:"absolute",left:"-10000px"}});processData(e,t);$("#results-container").prepend(t.children());t.remove()}},completeFunction:function(){intervalUpdate(this)},api:e};google.maps.event.trigger(window.map,"search",t)},1e4)}function calculateIconSize(){var e=Math.pow(1.3,window.map.getZoom());return e>100?100:e<5?5:e}function setAllMarkersMap(e){for(var t in window.markers){if(window.markers[t].invisible==undefined&&(e==null||window.markers[t].getMap()==null)){window.markers[t].setMap(e)}}}function closeAllInfoWindows(){for(var e in window.infoWindows){window.infoWindows[e].close()}}function toggleBounce(){if(window.marker.getAnimation()!=null){window.marker.setAnimation(null)}else{window.marker.setAnimation(google.maps.Animation.BOUNCE)}}function renderTemplateItem(e,t,n,r,i){if(r==undefined){r="%"}var s=this;try{var o=n!=null?getPropByString(s,n,i):null;if(o==null&&i!==undefined){o=i}e=e.replace(new RegExp("{"+r+"([^"+r+"]*){{"+t+"}}([^"+r+"]*)"+r+"}","ig"),o!=null&&o!=null?"$1"+o+"$2":"")}catch(u){var o="";if(i!==undefined){o=i}e=e.replace(new RegExp("{"+r+"[^"+r+"]*{{"+t+"}}[^"+r+"]*"+r+"}","ig"),o)}return e}function getPropByString(e,t,n){if(!t){return e}var r,i=t.split("."),s=i.length-1;if(s>0){for(var o=0;o<s;o++){r=i[o];var u=e[r];if(u!==undefined){e=u}else{if(n!==undefined){return n}throw"error"}}}else{var o=0;if(e[i[o]]==undefined){if(n!==undefined){return n}throw"error"}}return e[i[o]]}function start_load(e,t){t==undefined?false:!!t;if(e==undefined){e=$("#right_content")}window.faderCount++;if(window.faderCount==1&&!t){$('<div class="layout-fader"><div class="spinner"></div></div>').appendTo(e).fadeIn()}}function stop_load(){if(window.faderCount>0){window.faderCount--;/*if(window.faderCount==0)*/if($('div.layout-fader').length>0){$("div.layout-fader").fadeOut(400,function(){$(this).remove()})}}}function getWindowApi(){var e=[];$('[data-item="sources"] :checkbox').each(function(){if($(this).prop("checked")){e.push($(this).val())}});return e}function initJQuery(){function u(e){$(".atomic-block"+e).each(function(){var e=$(this).data("index");var t=$(this).find(".user-info"),n=parseInt(t.attr("timestepm"))+window.timeStart-parseInt(t.attr("timestart")),r=0;if(window.options.lang=="ru"){r=processTimeAgoRu(n)}else{r=processTimeAgo(n)}$(this).find(".user-info .time").text(r);var i=window.infoWindows[e];if(i!=undefined){var s=i.getContent().replace(/class="time">(.+)<\/div/,'class="time">'+r+"</div");i.setContent(s)}})}jQuery.fx.interval=50;window.api=getWindowApi();$.ajax({url:"/",async:true,type:"POST",data:{detect:1},dataType:"JSON",success:function(e){if(window.marker!=undefined&&window.marker.getPosition()==undefined){initMap(e.latitude,e.longitude)}}});setInterval(function(){window.timeStart++},1e3);for(var e=parseInt($(".tooltipster").length)-1;e>=0;e--){var t=$('.tooltipster[data-tooltip-index="'+e+'"]'),n='<div class="message">'+t.data("tooltip-content")+'</div><div class="close-ok">ok</div>',r=t.data("tooltip-position");t.tooltipster({content:n,contentAsHTML:true,trigger:"custom",position:r,animation:"grow",onlyOne:true,functionBefore:function(e,t){e.addClass("tooltipster-opened");t()},functionAfter:function(e){e.removeClass("tooltipster-opened")},functionReady:function(e,t){var n=e.data("tooltip-arrow");if(n!=undefined){t.find(".tooltipster-arrow").clone().removeClass().addClass("tooltipster-arrow-"+n+" tooltipster-arrow").appendTo(t)}t.find(".close-ok").on("click",function(){var t=e.data("tooltip-index");e.tooltipster("hide");$('.tooltipster[data-tooltip-index="'+(t+1)+'"]').tooltipster("show")})}});t.on("click",function(){if(!$(this).hasClass("tooltipster-opened")){return}var e=$(this).data("tooltip-index"),t=$('.tooltipster[data-tooltip-index="'+(e+1)+'"]');$(this).tooltipster("hide");if(t.length){t.tooltipster("show")}})}$("#header .show_tooltip, #mylocation").each(function(){var e=$(this).data("tooltip-content-mini");if(e){$(this).tooltipster({position:"top-left",offsetY:-5,content:e,animation:"grow",multiple:true,theme:"tooltipster-black"})}});var i=$("#hello_dialog");var s=$(".dialog-shadow");s.on("click",function(){i.fadeOut();s.fadeOut()});i.on("click",".close_dialog",function(){i.fadeOut();s.fadeOut()}).on("click",".gonow.a-button",function(){setCookie("steps",1,7);var e=i.find("#show-all-tooltips").prop("checked");s.fadeOut();i.fadeOut(function(){if(e){$('.tooltipster[data-tooltip-index="0"]').tooltipster("show")}})});if(!getCookie("steps")){i.fadeIn();s.fadeIn()}$("i.icon-info").on("click",function(){i.fadeIn();s.fadeIn()});$.each(window.icons,function(){$("<img/>",{src:this})});(function(){$.each(window.options,function(e){var t=this.valueOf(),n="removeClass",r=$('.section-wrapper[data-item!="socials"]').find("#"+e);r.prop("checked",t);if(t){n="addClass"}if(r.closest(".option-wrapper").find("label").length){r.closest(".option-wrapper").find("label")[n]("check")}else{r.closest(".option-wrapper")[n]("check")}$('.filters_photo > .section-wrapper[data-item="socials"]').find("#"+e).each(function(){var e=$(this).attr("id"),t=$(this);if(t.prop("checked")==true){if(e=="vklogin"){setTimeout(function(){VK.Auth.getLoginStatus(function(e){if(e.session==undefined||e.session==null){t.prop({checked:false}).closest(".option-wrapper").removeClass("check");$.ajax({url:"/social/logout/vk/",async:true,type:"GET"})}})},VK==undefined?500:0)}}})})})();window.stepsCount=Math.floor(((window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth)-30-41)/320);window.widthAnimation={duration:400,easing:"easeOutBack"};window.masonry=$("#results-container").masonry({columnWidth:300,itemSelector:".atomic-block.visible",gutter:20});$(document).on("loadImages",function(){$(".atomic-block:not(:visible) .main-picture img").one("load",function(){clearTimeout(window.timeoutMasonry);window.timeoutMasonry=setTimeout(function(){window.masonry.masonry()},200)}).each(function(){if(this.complete)$(this).load()})});$("#content").on("widthChange",function(e,t){if(t==undefined){t=window.step}if(t>window.stepsCount){t=window.stepsCount}if(window.scrollWidth==undefined){var n=$("#right_content");window.scrollWidth=n.get(0).offsetWidth-n.get(0).clientWidth}var r=$("html, body").width(),i=r-240,s=320*t+20+window.scrollWidth;if(s>i){var o=Math.floor((i-20-window.scrollWidth)/320);s=320*o+20+window.scrollWidth;$("#arrow_left").hide()}var u=$(this),a={width:s},f={width:s},l={width:(window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth)-s};if(t==1){f.height="+=55px"}else if(t==2&&window.step==1){f.height="-=55px"}if(t==1){u.find("#right_content").css("width",s)}else{u.find("#right_content").animate(a,window.widthAnimation)}u.find(".filters").animate(f,window.widthAnimation);u.find("#mapblock").animate(l,$.extend(window.widthAnimation,{complete:function(){if(window.map!=undefined){google.maps.event.trigger(window.map,"resize")}centerMapPosition()}}));var c=$("#show-new-photo");if(c.is(":visible")){c.css("marginRight",($("#right_content").width()-c.outerWidth())/2)}setTimeout(function(){u.find("#results-container").width(s-window.scrollWidth-40);window.masonry.masonry();u.find("#results-container").width("auto")},0);var h=$("#arrow_left"),p=$("#arrow_right");if(t==window.stepsCount){h.fadeOut(200)}else if(h.not(":visible")&&t<window.stepsCount){h.fadeIn(200)}if(t==1){p.fadeOut(200)}else if(p.not(":visible")&&t>1){p.fadeIn(200)}window.step=t;window.options.step=window.step;setCookie("options",JSON.stringify(window.options),7)});$("#content").trigger("widthChange",[window.options.step]);$("#arrow_left").on("click",function(e){e.preventDefault();var t=$("html, body").width();var n=t-240;if(n>660){$("#content").trigger("widthChange",[window.step+1])}else{$(this).fadeOut()}});$("#arrow_right").on("click",function(e){e.preventDefault();var t=$("html, body").width();var n=t-240;if(n>660){$("#content").trigger("widthChange",[window.step-1])}else{$(this).fadeOut()}});$("form#search").on("submit",function(e){e.preventDefault()});$("#search_submit").on("click",function(){window.api=getWindowApi();window.masonry.masonry("remove",$("#results-container").children().get());window.masonry.masonry();if(!window.api.length){return false}window.scroller_im=0;window.scroller_vk=0;$("#show-new-photo").fadeOut().find("span").text(1);$("#results-container").html("");window.pagenumber=1;window.showpages=1;window.minscroll=0;window.maxscroll=0;window.prev_height=0;window.item_numder=1;window.marker_numder=1;window.pagemarker=1;var e=window.marker.getPosition();reloadDefaults();if(e==undefined||e.lat()!=getDefaults("lat")||e.lng()!=getDefaults("lng")){var t=new google.maps.LatLng(getDefaults("lat"),getDefaults("lng"));window.marker.setOptions({zIndex:0,animation:google.maps.Animation.DROP,position:t});window.map.setCenter(t)}window.circle.setOptions({radius:parseInt(getDefaults("distance")),center:window.marker.getPosition()});try{for(var n in window.findAjax){clearTimeout(window.intervalUpdating[n]);window.findAjax[n].abort()}}catch(r){}window.minTime=[];for(var n in window.api){clearTimeout(window.intervalUpdating[n]);google.maps.event.trigger(window.map,"search",{api:window.api[n]})}});window.apisStatus={};window.apisPic={};$('.section-wrapper[data-item="socials"] .option-wrapper').each(function(){var e=$(this).find(":checkbox"),t=e.attr("id").substr(0,2);window.apisStatus[t]=e.prop("checked")?"":null;window.apisPic[t]=e.prop("checked")?e.data("img"):null});$(document).on("click",".buttons .button_right",function(){if(!$(this).find(".button").hasClass("active")){return false}if($(this).closest("#hello_dialog_starmap").length>0){$("#hello_dialog_starmap").fadeOut(200);$(".dialog-shadow-black").fadeOut(200)}$("html,body").animate({scrollTop:$("#center-block").offset().top});var e=$(this).closest(".atomic-block").data("index");google.maps.event.trigger(window.markers[e],"click")});$(document).on("click",".close-popap",function(){$(this).parent().fadeOut()});$(document).on("click",".buttons .button_left",function(){var e=$(this).closest(".atomic-block").data("index"),t=$(this).closest(".atomic-block").data("api");var n=$(this),r=$(this).parent().find(".popap_content"),i=1;if(!$(this).find(".button").hasClass("active")){if(t=="vk"){r.find(".message").hide()}else{r.find(".messageVK").hide()}$(".popap_content:visible ").hide();r.fadeIn();setTimeout(function(){r.fadeOut()},3e3);return;return false}if($(this).find(".button").hasClass("liked")){i=0}if(t=="im"){$.ajax({url:"/like/",data:{api:t,media_id:e,liked:i},type:"POST",dataType:"json",success:function(s){if(s.not_user==1){$(".popap_content:visible ").hide();if(t=="vk"){r.find(".message").hide()}else{r.find(".messageVK").hide()}r.fadeIn();setTimeout(function(){r.fadeOut()},3e3)}else{if(i==1){n.find(".button").addClass("liked")}else{n.find(".button").removeClass("liked")}if(n.parents("#zoom-slider").length>0){if(i==1){$("#"+e).find(".button_left .button").addClass("liked")}else{$("#"+e).find(".button_left .button").removeClass("liked")}}}}})}});$(document).on("click",".buttons .button_views",function(){if($(this).find(".button").hasClass("active")){window.open($(this).find(".button").data("picurl"),"_blank")}});$(document).on({mouseenter:function(){$("#share_item .share42init").attr("data-url",$(this).attr("sharelink"));$.getScript("http://staremap.com/share42.js",function(){});var e=parseInt($(this).offset().left)-27;var t=parseInt($(this).offset().top)-30;$("#share_item").css("left",e).css("top",t).show()},mouseleave:function(){$("#share_item").hide()}},".button_share");$(document).on("click",".button_share",function(){});$(".filter-range").noUiSlider({start:getDefaults("distance"),connect:"lower",direction:"ltr",range:{min:100,max:5e3},serialization:{lower:[$.Link({target:$("#distance")}),$.Link({target:function(e){if(window.circle!=undefined){window.circle.setOptions({radius:parseInt(e)})}},format:{decimals:0}}),$.Link({target:$("#range_count-filter"),method:"html"})],format:{mark:".",decimals:0}}});$(".filter-range").on("change",function(){$("#search_submit").trigger("click")});if(navigator.geolocation){$(".header-location-button, #mylocation").on("click",function(){navigator.geolocation.getCurrentPosition(function(e){initMap(e.coords.latitude,e.coords.longitude)},function(e){},{enableHighAccuracy:true,maximumAge:36e5,timeout:27e3});return false})}else{$(".header-location-button").hide();$("#mylocation").hide()}$(".header-options-button").on("click.slideOption",function(){var e=$(this);if(e.hasClass("header-options-button--touched")){$("body").off(".slideOption");e.prev().slideUp(function(){$(this).next().removeClass("header-options-button--touched")})}else{e.addClass("header-options-button--touched");setTimeout(function(){e.prev().slideDown(function(){$("body").on("click.slideOption",function(e){if($(e.target).closest(".header-options-block").length){return false}$(".header-options-button").trigger("click.slideOption");$("body").off(".slideOption")})})},200)}return false});$(".created_block select").selectbox();$(".created_block select").on("change",function(){$("#search_submit").trigger("click")});$(".filter-option").on("click",function(){var e=$(this),t=e.data("for"),n=$("#"+t),r=e.closest(".filter-container").data("item"),i=true,s="addClass";if(e.hasClass("check")){i=false;s="removeClass"}e[s]("check").find(":checkbox").prop("checked",i);window.options[t]=i;if(!i){if(r=="classes"){$(".atomic-block").find("li."+t+"s").addClass("is-none");window.masonry.masonry()}else if(r=="socials"){$(this).off("click");var o=t.substr(0,2);$.ajax({url:"/social/logout/"+o+"/",type:"GET",complete:function(){if(o=="vk"){VK.Auth.logout(function(){window.location.reload()})}else{window.location.reload()}}})}else if(r=="sources"){$("#search_submit").trigger("click")}}else{if(r=="classes"){$(".atomic-block").find("li."+t+"s").removeClass("is-none");window.masonry.masonry()}else if(r=="socials"){$(this).off("click");if(n.data("url")!=undefined){if(t=="vklogin"){VK.Auth.login(function(e){if(e.session){$.ajax({url:"/social/vk/",data:{userInfo:e},type:"POST",complete:function(){window.location.reload()}})}},65536);return false}else{window.location.href=n.data("url");return false}}}else if(r=="sources"){$("#search_submit").trigger("click")}}setCookie("options",JSON.stringify(window.options),7)});$(".icon.icon-cogwheel").on("click",function(){var e=$(this).closest(".user_block");if(!e.hasClass("activeblock")){e.addClass("activeblock").animate({right:0},{duration:400,easing:"easeOutBack"})}else{e.animate({right:-320},{duration:400,easing:"easeInBack",complete:function(){e.removeClass("activeblock")}})}return false});$("#show-new-photo").on("click",function(){$(this).slideUp();for(var e in window.markers){if(window.markers[e].invisible!=undefined&&window.markers[e].labelClass==undefined){delete window.markers[e].invisible}}setAllMarkersMap(window.map);$("#right_content").animate({scrollTop:0},400,function(){u("");var e=$("#results-container").find(".atomic-block:not(.visible)").addClass("visible");window.masonry.masonry("prepended",e.get())});return false});$(document).on({focusin:function(){$(this).data("placeholder",$(this).attr("placeholder")).attr("placeholder","")},focusout:function(){$(this).attr("placeholder",$(this).data("placeholder"))}},"[placeholder]");$("#right_content").scrollTop(0);var o=true;$("#right_content").on("scroll",function(){if(window.faderCount<1&&$(this).scrollTop()+$(this).innerHeight()>=this.scrollHeight-66-200&&(window.scroller_im>0||window.scroller_vk>0)){if(window.scrollcount<1e3){ga("send","event","Scroll","Load-foto-"+window.scrollcount,"load")}window.scrollcount++;$(document).trigger("showMore")}});$(document).on("showMore",function(){if(!window.api.length){return false}for(var e in window.api){google.maps.event.trigger(window.map,"search",{preAjax:function(){start_load($(".result-wrapper"),false)},api:window.api[e],more:true,generateData:function(){return{lat:getDefaults("lat"),lng:getDefaults("lng"),distance:getDefaults("distance"),time:getDefaults("time"),etime:window.minTime[this.api]}},completeFunction:$.noop,successFunction:function(e){if(!Object.keys&&e!=null&&e.data!=undefined){var t=$("<div/>",{css:{position:"absolute",left:"-10000px"}});u(".visible");processData(e,t,false,true);var n=t.children();$("#results-container").append(n);t.remove();$(document).trigger("loadImages");n.addClass("visible");window.masonry.masonry("appended",n.get())}else if(e!=null&&e.data!=undefined&&Object.keys(e.data).length>0){var t=$("<div/>",{css:{position:"absolute",left:"-10000px"}});u(".visible");processData(e,t,false,true);var n=t.children();$("#results-container").append(n);t.remove();$(document).trigger("loadImages");n.addClass("visible");window.masonry.masonry("appended",n.get())}stop_load()}})}return false});$(document).on("click",".tag",function(e){e.preventDefault()});$("#contact_us").on("click",function(){$("#contactform").fadeIn(200);$(".dialog-shadow-black").fadeIn(200)});$("#contactform .close_contact").on("click",function(){$(".dialog-shadow-black").fadeOut(200);$("#contactform").fadeOut(200)});$("#contactform #contact_button").on("click",function(){var e=$(this).parent(),t={},n=false;t.name=e.find("#fio_cont").val();t.email=e.find("#email_cont").val();t.text=e.find("#contact_text").val();if(!t.name||t.name.length<3){n=true;e.find("#fio_cont").addClass("error")}var r=/^([a-z0-9_\.-])+@[a-z0-9-]+\.([a-z]{2,4}\.)?[a-z]{2,4}$/i;if(t.email.length<3||!r.test(t.email)){n=true;e.find("#email_cont").addClass("error")}if(!t.text||t.text.length<3){n=true;e.find("#contact_text").addClass("error")}if(!n){e.find("#fio_cont").val("");e.find("#email_cont").val("");e.find("#contact_text").val("");$("#contactform").hide();var i="/contact/";if($("body").attr("curlang")=="ru"){var i="/ru/contact/"}$.ajax({type:"POST",url:i,data:{contact:t},async:false,dataType:"json",success:function(e){$("#massegecenter").text(e).show();setTimeout(function(){$("#massegecenter").fadeOut(200);$(".dialog-shadow-black").fadeOut(200)},2500)},error:function(){console.log("error")}})}return false});$("#contactform").on("click ",".conact_inp.error",function(){$(this).removeClass("error")});$(document).on("click",".main-picture.icon-zoom",function(){var e=$.trim($("#templateZoom").html()),t=$(this).closest(".atomic-block"),n={apithis:t.data("api"),sharelink:t.find(".buttons .button_share").attr("sharelink"),index:t.data("index"),head:t.find("li.head").html(),buttons:t.find("li.buttons").html(),tags:t.find("li.tags").html(),peoples:t.find("li.peoples").html(),comments:t.find("li.comments").html(),imagelink:t.find("li.main-picture").data("picurl"),img:t.find("li.main-picture").data("bigimg"),apiname:t.data("api")=="vk"?"VK":"IG"};var r=t.css("top");$("#right_content").scrollTop(parseInt(r)-20);var i=e;for(var s in n){i=renderTemplateItem.apply(n,[i,s,s])}if($("#zoom-slider").is(":visible")){$("#zoom-slider").append(i)}else{$("#zoom-slider").html(i).closest("#hello_dialog_starmap").fadeIn(200);$(".dialog-shadow-black").fadeIn(200)}$("#arrow_left_dialog,#arrow_right_dialog").show();$("#zoom-slider .buttons .popap_content").hide()});$("#hello_dialog_starmap .close").on("click",function(){$(".dialog-shadow-black").fadeOut(200);$("#hello_dialog_starmap").fadeOut(200)});$(".dialog-shadow-black").on("click",function(){$(this).fadeOut(200);$("#hello_dialog_starmap").fadeOut(200);$("#contactform").fadeOut(200)});$('#hello_dialog_starmap a[id^="arrow_"]').on("click",function(e){e.preventDefault();var t=$("#zoom-slider"),n,r,i=$("#hello_dialog_starmap .atomic-block").data("index"),s=t.find(".atomic-zoom:first"),o=s.width();if(t.hasClass("animating")){return false}t.addClass("animating");if($(this).attr("id")=="arrow_left_dialog"){r="prev"}else{r="next"}n=$('ul.list .atomic-block[data-index="'+i+'"]')[r](":visible");if(!n.length){t.removeClass("animating");return $(this).hide()}$('#hello_dialog_starmap a[id^="arrow_"]').show();n.find(".main-picture.icon-zoom").trigger("click");t.width(o*2);if(r=="prev"){var u=t.find(".atomic-zoom:last");u.prependTo(t);t.css({marginLeft:-o});t.animate({marginLeft:0},function(){s.remove();t.width(o);t.removeClass("animating")})}else{t.animate({marginLeft:-o},function(){s.remove();t.width(o).css({marginLeft:0});t.removeClass("animating")})}})}function share42resize(){$("body").addClass("en-share")}function photosesion(){if($("#header").attr("apiinfo")!=undefined){$.ajax({type:"POST",url:"/photosesion/",data:{photo:"info"},async:false,dataType:"json",success:function(e){if(e.api=="vk"){if(e.lat&&e.long){setCookie("navigation",JSON.stringify({lat:e.lat,lng:e.long}),1);$container=$("#results-container");var t={};var n=[];n.push(e);t.api="vk";t.data=n;setTimeout(function(){processData(t,$container,true)},200)}}else{if(e.location.latitude&&e.location.longitude){setCookie("navigation",JSON.stringify({lat:e.location.latitude,lng:e.location.longitude}),1);$container=$("#results-container");var t={};var n=[];n.push(e);t.api="im";t.activeuser=e.activeuser.im;t.data=n;setTimeout(function(){processData(t,$container,true)},200)}}},error:function(){}})}}function resizemap(){var e=$(this).width();var t=parseInt($("#show-new-photo").css("margin-right"))+150;if(e<t){$("#show-new-photo").css("margin-right",50)}var n=$(this).height()-67;$("#content").height(n);var r=$("#mapblock").width();var i=e-r;if(i<340){$("#mapblock").width(e-340);$("#right_content").width(340)}else{$("#right_content").width(e-r)}}window.vkAsyncInit=function(){VK.init({apiId:4507081})};setTimeout(function(){var e=document.createElement("script");e.type="text/javascript";/*e.src="http://vk.com/js/api/openapi.js";*/e.src = '/skin/default_skin/frontend/js/openapi.js';e.async=true;document.getElementById("vk_api").appendChild(e)},0);setDefaults({lat:25.772532657999804,lng:-80.19247055053711,distance:2e3,time:1440});if(window.devicePixelRatio!=undefined&&window.devicePixelRatio>=2){window.icons=["/skin/default_skin/frontend/img/icon-pin-active.png","/skin/default_skin/frontend/img/icon-pin-idle@2x.png","/skin/default_skin/frontend/img/icon-pin-center@2x.png","/skin/default_skin/frontend/img/close.png"]}else{window.icons=["/skin/default_skin/frontend/img/icon-pin-active.png","/skin/default_skin/frontend/img/icon-pin-idle.png","/skin/default_skin/frontend/img/icon-pin-center.png","/skin/default_skin/frontend/img/close.png"]}window.findAjax=[];window.intervalTiming=[];window.intervalUpdating=[];window.minTime=[];window.timeStart=0;window.scrollcount=1;window.options={tag:true,people:true,comment:true,im:true,vk:true,gp:true,imlogin:false,vklogin:false,gplogin:false,step:2,lang:$("body").attr("curlang")};(function(){if(getCookie("options")){var e=jQuery.parseJSON(getCookie("options"));for(var t in e){if(t=="lang"){window.options[t]=window.options.lang}else{window.options[t]=e[t]}}}})();SearchPhoto=function(){var e={preAjax:function(){window.marker.setOptions({animation:google.maps.Animation.BOUNCE});setAllMarkersMap(null);closeAllInfoWindows();start_load();window.markers={};window.infoWindows=[]},generateData:function(){return{lat:getDefaults("lat"),lng:getDefaults("lng"),distance:getDefaults("distance"),time:getDefaults("time")}},successFunction:function(e){var t=$("#results-container");if(!Object.keys&&e!=null&&e.data!=undefined){processData(e,t,true)}else if(e.data!=undefined&&e!=null&&Object.keys(e.data).length>0){processData(e,t,true)}stop_load();setTimeout(function(){if($("#results-container > li.visible").length>0){$(".content_nophoto").hide()}else{$(".content_nophoto").fadeIn()}},2500)},errorFunction:function(){stop_load()},completeFunction:function(){window.marker.setOptions({animation:null});intervalUpdate(this)},more:false,api:null};var t={mergeConfig:function(n){t.config=$.extend(true,{},e,n)},init:function(e){t.mergeConfig(e);return t.sendRequest()},sendRequest:function(){if(t.config.api==null){return false}t.config.preAjax();window.findAjax[t.config.api]=$.ajax({url:"/find/",type:"POST",dataType:"json",data:$.extend({bounds:{swlat:window.circle.getBounds().getSouthWest().lat(),swlng:window.circle.getBounds().getSouthWest().lng(),nelat:window.circle.getBounds().getNorthEast().lat(),nelng:window.circle.getBounds().getNorthEast().lng()},api:t.config.api},t.config.generateData.apply(t.config)),success:t.config.successFunction,error:t.config.errorFunction,complete:t.config.completeFunction.apply(t.config.api)})}};SearchPhoto.prototype.init=t.init;return this};window.onload=function(){AddScript("https://maps.googleapis.com/maps/api/js?v=3.exp&sensor=false&callback=loadInfobox&libraries=places&language="+window.options.lang)};window.faderCount=0;window.scroller=1;window.scroller_vk=1;window.scroller_im=1;window.prev_height=0;window.ajaxcount=50;window.item_numder=1;window.pagenumber=1;window.marker_numder=1;window.pagemarker=1;window.showpages=1;window.minscroll=0;window.maxscroll=0;window.scroll_ident=500;$(window).resize(function(){resizemap()});$(document).ready(function(){resizemap();if($("body").attr("curlang")!="ru"){share42resize()}$(".share42init").on("click","span a",function(){var e=$(this).data("count");if($("body").attr("curlang")=="ru"){switch(e){case"vk":ga("send","event","Like","VK","plugin-ru");break;case"fb":ga("send","event","Like","FB","plugin-ru");break;case"twi":ga("send","event","Like","TW","plugin-ru");break;case"gplus":ga("send","event","Like","G+","plugin-ru");break;case"odkl":ga("send","event","Like","OK","plugin-ru");break}}else{switch(e){case"fb":ga("send","event","Like","FB","plugin-en");break;case"twi":ga("send","event","Like","TW","plugin-en");break;case"gplus":ga("send","event","Like","G+","plugin-en");break}}})})